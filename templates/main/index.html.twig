{% extends 'base.html.twig' %}

{% block title %}{{'Winback Interface | Home | Welcome !'|trans}}{% endblock %}

{% block content %}
    {#{{ render_esi(path('ch_cookie_consent.show')) }}#}
    {#
    {% if chcookieconsent_isCookieConsentSavedByUser() != true %}
    <div class="modal" tabindex="-1" id="exampleModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                {{ render_esi(path('ch_cookie_consent.show_if_cookie_consent_not_set')) }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    #}
    <div class="container py-5 bg-light rounded-3 d-flex flex-column align-items-center w-100">
        <div class="d-flex align-items-center">
            <div><img src="{{asset('img/avatar.png')}}" alt="avatar" style="width: 5em; height: auto; border-radius: 50%; margin-right: 2em;" class="btn-shadow"></div>
            <div style="color: #4f4f4f;">
                <h2><span>{{ 'Welcome,'|trans }}</span> <span style="font-weight: 400">{{app.user.username}}</span></h2>
                <div class="lead">{{ 'On your personal dashboard'|trans }}</div>
            </div>
        </div>
        <hr style="width: 50%">
        {% if is_granted("ROLE_READER") %}
        <div class="row d-flex align-items-stretch justify-content-between w-50">
            
            <div class="col col-lg-4 card shadow-1 hoverable-1 rounded-3 white card-index" style="min-width: 15em;">
                <a href="{{path('software')}}">
                <div class="card-body">
                <h6 class="text-nowrap">{{ 'Softwares'|trans }}</h6>
                {{ 'Manage the versions available in the database, add or delete a new software.'|trans }}
                </div>
                </a>
            </div>
            
            
            <div class="col col-lg-4 card shadow-1 hoverable-1 rounded-3 white card-index" style="min-width: 15em;">
                <a href="{{path('device')}}">
                    <div class="card-body">
                    <h6 class="text-nowrap">{{ 'Devices'|trans }}</h6>
                    {{ 'Manage the devices available on the server, edit an existing device.'|trans }}
                    </div>
                </a>   
            </div>
            
            {% if is_granted("ROLE_ADMIN") %}
            <div class="col col-lg-4 card shadow-1 hoverable-1 rounded-3 white card-index" style="min-width: 15em;">
            <a href="{{path('dashboard')}}">
                <div class="card-body">
                <h6 class="text-nowrap">{{ 'Dashboard'|trans }}</h6>
                {{ 'Visualize the number of devices updated in the database.'|trans }}
                </div>
            </a>
            </div>
            {% endif %}
            
        </div>
            {% if is_granted("ROLE_ADMIN") %}
            <div class="row h-100 mt-5 d-flex align-items-center justify-content-center">
                <div style="height: 25em; width: 30em;">
                {{ render_chart(firstChart) }}
                </div>
                <div style="height: 25em; width: 30em;">
                {{ render_chart(secondChart) }}
                </div>
                <div style="height: 25em; width: 30em;">
                {{ render_chart(thirdChart) }}
                </div>
            </div>
            {% endif %}
        {% elseif is_granted("ROLE_CLIENT")%}
        <div class="">
            <!-- 
            if user is role client &
            if user is in client table, show sn + informations
            -->
            
            <!--
            if user doesn't exist in client table & is role client :
            - show "register your device"
            - valid form
            - register user in client table
            - in client table, link sn
            -->
            {% if clientIdentified and clientToSn %}
            You are identified, well done !
            <table class="table table-striped table-bordered table-hover w-100">
                <thead>
                    <tr>
                    <th>Serial Number</th>
                    </tr>
                </thead>
                <tbody>
                {% for client in clientToSn %}
                <tr>
                <td>{{client.Sn}}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

            {% else %}
            {{ 'You are not identified yet. Please enter your Info to verify your identity and find your device.'|trans }}
            
            <!-- when form is submitted, send automatically a mail to admin to request client registration -->
            {#
            {{ form_start(clientRegistration) }}
                {{ form_row(clientRegistration.email) }}
                {{ form_row(clientRegistration.serial_number) }}
                <button>Submit</button>
            {{ form_end(clientRegistration) }}
            #}
            {{ form_start(clientRegistration) }}
                {{ form_row(clientRegistration.email) }}
                {#
                {{ form_row(clientRegistration.serial_number) }}
                #}
                <button>Submit</button>
            {{ form_end(clientRegistration) }}
            <!--
            <form action="">
                <input type="text" placeholder="{{ 'Enter your SN'|trans }}">
                <input type="text" placeholder="{{ 'Enter your Username or Mail'|trans }}">
            </form>
            -->
            <!--TODO Maybe send a recap mail with info -->
            {% endif %}
        </div>

        {% else %}
        You have no permissions attributed yet, Please wait for the admin team to authorise access.
        {% endif %}
    </div>
{% endblock %}

{#
{% block javascripts %}
    <script src="{{ asset('js/main.js')}}"></script>
{% endblock %}
#}